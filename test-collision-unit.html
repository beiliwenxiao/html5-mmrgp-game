<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¢°æ’æ£€æµ‹å•å…ƒæµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #fff;
        }
        
        #container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #4CAF50;
        }
        
        .test-case {
            background: #1a1a1a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
        }
        
        .test-pass {
            color: #4CAF50;
        }
        
        .test-fail {
            color: #f44336;
        }
        
        .test-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .test-detail {
            color: #888;
            font-size: 0.9em;
            margin-left: 20px;
        }
        
        #summary {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: center;
            font-size: 1.2em;
        }
        
        .summary-pass {
            border: 3px solid #4CAF50;
        }
        
        .summary-fail {
            border: 3px solid #f44336;
        }
        
        pre {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div id="container">
        <h1>ğŸ§ª ç¢°æ’æ£€æµ‹å•å…ƒæµ‹è¯•</h1>
        <div id="results"></div>
        <div id="summary"></div>
    </div>

    <script type="module">
        import { MovementSystem } from './src/systems/MovementSystem.js';
        import { Entity } from './src/ecs/Entity.js';
        import { TransformComponent } from './src/ecs/components/TransformComponent.js';
        import { MovementComponent } from './src/ecs/components/MovementComponent.js';

        const results = document.getElementById('results');
        const summary = document.getElementById('summary');
        
        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;
        
        // æµ‹è¯•ç»“æœè®°å½•
        function logTest(sectionName, testName, passed, details = '') {
            totalTests++;
            if (passed) {
                passedTests++;
            } else {
                failedTests++;
            }
            
            const section = document.getElementById(sectionName) || createSection(sectionName);
            const testCase = document.createElement('div');
            testCase.className = 'test-case';
            
            const status = passed ? 'âœ“' : 'âœ—';
            const statusClass = passed ? 'test-pass' : 'test-fail';
            
            testCase.innerHTML = `
                <div class="test-name ${statusClass}">${status} ${testName}</div>
                ${details ? `<div class="test-detail">${details}</div>` : ''}
            `;
            
            section.appendChild(testCase);
        }
        
        function createSection(name) {
            const section = document.createElement('div');
            section.className = 'test-section';
            section.id = name;
            section.innerHTML = `<h2>${name}</h2>`;
            results.appendChild(section);
            return section;
        }
        
        function showSummary() {
            const allPassed = failedTests === 0;
            summary.className = allPassed ? 'summary-pass' : 'summary-fail';
            summary.innerHTML = `
                <div>æµ‹è¯•å®Œæˆ</div>
                <div>æ€»è®¡: ${totalTests} | é€šè¿‡: ${passedTests} | å¤±è´¥: ${failedTests}</div>
                <div style="margin-top: 10px; font-size: 2em;">
                    ${allPassed ? 'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼' : 'âš ï¸ æœ‰æµ‹è¯•å¤±è´¥'}
                </div>
            `;
        }
        
        // è¾…åŠ©å‡½æ•°
        function createTestEntity(x = 0, y = 0, speed = 100) {
            const entity = new Entity('test-entity', 'player');
            entity.addComponent(new TransformComponent(x, y));
            entity.addComponent(new MovementComponent({ speed }));
            return entity;
        }
        
        // ==================== æµ‹è¯•å¼€å§‹ ====================
        
        // 1. AABB ç¢°æ’æ£€æµ‹æµ‹è¯•
        const sectionAABB = 'AABB ç¢°æ’æ£€æµ‹';
        
        try {
            const system = new MovementSystem({});
            
            // æµ‹è¯•1.1: é‡å çŸ©å½¢
            const rect1 = { x: 0, y: 0, width: 50, height: 50 };
            const rect2 = { x: 25, y: 25, width: 50, height: 50 };
            const collides1 = system.checkAABBCollision(rect1, rect2);
            logTest(sectionAABB, 'é‡å çŸ©å½¢åº”è¯¥ç¢°æ’', collides1 === true, 
                `rect1: (0,0,50,50), rect2: (25,25,50,50) => ${collides1}`);
            
            // æµ‹è¯•1.2: åˆ†ç¦»çŸ©å½¢
            const rect3 = { x: 100, y: 100, width: 50, height: 50 };
            const collides2 = system.checkAABBCollision(rect1, rect3);
            logTest(sectionAABB, 'åˆ†ç¦»çŸ©å½¢ä¸åº”è¯¥ç¢°æ’', collides2 === false,
                `rect1: (0,0,50,50), rect3: (100,100,50,50) => ${collides2}`);
            
            // æµ‹è¯•1.3: è¾¹ç¼˜æ¥è§¦
            const rect4 = { x: 50, y: 0, width: 50, height: 50 };
            const collides3 = system.checkAABBCollision(rect1, rect4);
            logTest(sectionAABB, 'è¾¹ç¼˜æ¥è§¦ä¸åº”è¯¥ç¢°æ’', collides3 === false,
                `rect1: (0,0,50,50), rect4: (50,0,50,50) => ${collides3}`);
            
            // æµ‹è¯•1.4: å®Œå…¨åŒ…å«
            const rect5 = { x: 10, y: 10, width: 20, height: 20 };
            const collides4 = system.checkAABBCollision(rect1, rect5);
            logTest(sectionAABB, 'å®Œå…¨åŒ…å«åº”è¯¥ç¢°æ’', collides4 === true,
                `rect1: (0,0,50,50), rect5: (10,10,20,20) => ${collides4}`);
            
            // æµ‹è¯•1.5: éƒ¨åˆ†é‡å ï¼ˆå·¦ä¸Šï¼‰
            const rect6 = { x: -25, y: -25, width: 50, height: 50 };
            const collides5 = system.checkAABBCollision(rect1, rect6);
            logTest(sectionAABB, 'éƒ¨åˆ†é‡å ï¼ˆå·¦ä¸Šï¼‰åº”è¯¥ç¢°æ’', collides5 === true,
                `rect1: (0,0,50,50), rect6: (-25,-25,50,50) => ${collides5}`);
            
        } catch (error) {
            logTest(sectionAABB, 'AABBæµ‹è¯•å¼‚å¸¸', false, error.message);
        }
        
        // 2. åœ°å›¾è¾¹ç•Œæ£€æµ‹æµ‹è¯•
        const sectionBounds = 'åœ°å›¾è¾¹ç•Œæ£€æµ‹';
        
        try {
            const system = new MovementSystem({
                mapBounds: { minX: 0, minY: 0, maxX: 500, maxY: 500 }
            });
            
            // æµ‹è¯•2.1: è¾¹ç•Œå†…çš„ç‚¹
            logTest(sectionBounds, 'è¾¹ç•Œå†…çš„ç‚¹åº”è¯¥æœ‰æ•ˆ', 
                system.isWithinMapBounds(250, 250) === true,
                'ç‚¹ (250, 250) åœ¨è¾¹ç•Œ (0,0,500,500) å†…');
            
            // æµ‹è¯•2.2: å·¦è¾¹ç•Œå¤–
            logTest(sectionBounds, 'å·¦è¾¹ç•Œå¤–çš„ç‚¹åº”è¯¥æ— æ•ˆ',
                system.isWithinMapBounds(-10, 250) === false,
                'ç‚¹ (-10, 250) åœ¨è¾¹ç•Œå¤–');
            
            // æµ‹è¯•2.3: å³è¾¹ç•Œå¤–
            logTest(sectionBounds, 'å³è¾¹ç•Œå¤–çš„ç‚¹åº”è¯¥æ— æ•ˆ',
   