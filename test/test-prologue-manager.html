<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åºç« ç®¡ç†å™¨æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .test-section h2 {
            color: #667eea;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: #6c757d;
        }

        button.secondary:hover {
            background: #5a6268;
        }

        button.danger {
            background: #dc3545;
        }

        button.danger:hover {
            background: #c82333;
        }

        .info-box {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            border: 1px solid #dee2e6;
        }

        .info-box h3 {
            margin-top: 0;
            color: #495057;
            font-size: 16px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: bold;
            color: #495057;
        }

        .info-value {
            color: #667eea;
        }

        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            line-height: 1.5;
        }

        .log-entry {
            margin-bottom: 5px;
        }

        .log-entry.info {
            color: #4ec9b0;
        }

        .log-entry.warn {
            color: #dcdcaa;
        }

        .log-entry.error {
            color: #f48771;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-badge.active {
            background: #28a745;
            color: white;
        }

        .status-badge.inactive {
            background: #6c757d;
            color: white;
        }

        .status-badge.completed {
            background: #17a2b8;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® åºç« ç®¡ç†å™¨æµ‹è¯•</h1>
        <p class="subtitle">å¼ è§’é»„å·¾èµ·ä¹‰åºç«  - PrologueManager åŠŸèƒ½æµ‹è¯•</p>

        <!-- åˆå§‹åŒ–æµ‹è¯• -->
        <div class="test-section">
            <h2>1. åˆå§‹åŒ–æµ‹è¯•</h2>
            <div class="button-group">
                <button onclick="testInit()">åˆå§‹åŒ–åºç« ç®¡ç†å™¨</button>
                <button onclick="testStartPrologue()">å¼€å§‹åºç« </button>
                <button class="secondary" onclick="testLoadProgress()">åŠ è½½è¿›åº¦</button>
            </div>
            <div class="info-box" id="initInfo">
                <h3>åˆå§‹åŒ–çŠ¶æ€</h3>
                <div class="info-item">
                    <span class="info-label">åˆå§‹åŒ–çŠ¶æ€:</span>
                    <span class="info-value" id="initStatus">æœªåˆå§‹åŒ–</span>
                </div>
                <div class="info-item">
                    <span class="info-label">åºç« çŠ¶æ€:</span>
                    <span class="info-value" id="activeStatus">æœªæ¿€æ´»</span>
                </div>
            </div>
        </div>

        <!-- åœºæ™¯åˆ‡æ¢æµ‹è¯• -->
        <div class="test-section">
            <h2>2. åœºæ™¯åˆ‡æ¢æµ‹è¯•</h2>
            <div class="button-group">
                <button onclick="testGoToAct(1)">ç¬¬ä¸€å¹•</button>
                <button onclick="testGoToAct(2)">ç¬¬äºŒå¹•</button>
                <button onclick="testGoToAct(3)">ç¬¬ä¸‰å¹•</button>
                <button onclick="testGoToAct(4)">ç¬¬å››å¹•</button>
                <button onclick="testGoToAct(5)">ç¬¬äº”å¹•</button>
                <button onclick="testGoToAct(6)">ç¬¬å…­å¹•</button>
            </div>
            <div class="info-box" id="sceneInfo">
                <h3>å½“å‰åœºæ™¯ä¿¡æ¯</h3>
                <div class="info-item">
                    <span class="info-label">å½“å‰å¹•æ•°:</span>
                    <span class="info-value" id="currentAct">0</span>
                </div>
                <div class="info-item">
                    <span class="info-label">å¹•åç§°:</span>
                    <span class="info-value" id="actName">-</span>
                </div>
            </div>
        </div>

        <!-- ç©å®¶æ•°æ®æµ‹è¯• -->
        <div class="test-section">
            <h2>3. ç©å®¶æ•°æ®æµ‹è¯•</h2>
            <div class="button-group">
                <button onclick="testRecordChoice()">è®°å½•é€‰æ‹©</button>
                <button onclick="testRecruitNPC()">æ‹›å‹ŸNPC</button>
                <button onclick="testRecordBattle()">è®°å½•æˆ˜æ–—</button>
                <button onclick="testShowPlayerData()">æ˜¾ç¤ºç©å®¶æ•°æ®</button>
            </div>
            <div class="info-box" id="playerInfo">
                <h3>ç©å®¶æ•°æ®</h3>
                <div class="info-item">
                    <span class="info-label">è§’è‰²åç§°:</span>
                    <span class="info-value" id="playerName">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ç­‰çº§:</span>
                    <span class="info-value" id="playerLevel">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">è´§å¸:</span>
                    <span class="info-value" id="playerCurrency">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æ‹›å‹Ÿçš„NPC:</span>
                    <span class="info-value" id="recruitedNPCs">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æˆ˜æ–—èƒœåˆ©:</span>
                    <span class="info-value" id="battlesWon">-</span>
                </div>
            </div>
        </div>

        <!-- è¿›åº¦ç®¡ç†æµ‹è¯• -->
        <div class="test-section">
            <h2>4. è¿›åº¦ç®¡ç†æµ‹è¯•</h2>
            <div class="button-group">
                <button onclick="testSaveProgress()">ä¿å­˜è¿›åº¦</button>
                <button onclick="testLoadProgress()">åŠ è½½è¿›åº¦</button>
                <button class="danger" onclick="testClearProgress()">æ¸…é™¤è¿›åº¦</button>
                <button onclick="testCompleteAct()">å®Œæˆå½“å‰å¹•</button>
                <button onclick="testCompletePrologue()">å®Œæˆåºç« </button>
            </div>
            <div class="info-box" id="progressInfo">
                <h3>è¿›åº¦ä¿¡æ¯</h3>
                <div class="info-item">
                    <span class="info-label">å·²å®Œæˆå¹•æ•°:</span>
                    <span class="info-value" id="completedActs">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">åºç« å®Œæˆ:</span>
                    <span class="info-value" id="prologueCompleted">å¦</span>
                </div>
            </div>
        </div>

        <!-- æ—¥å¿—è¾“å‡º -->
        <div class="test-section">
            <h2>5. æ§åˆ¶å°æ—¥å¿—</h2>
            <div class="button-group">
                <button class="secondary" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
            </div>
            <div class="log-container" id="logContainer">
                <div class="log-entry info">ç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { PrologueManager } from '../src/prologue/PrologueManager.js';
        import { SceneManager } from '../src/core/SceneManager.js';
        import { AudioManager } from '../src/core/AudioManager.js';
        import { InputManager } from '../src/core/InputManager.js';
        import { AssetManager } from '../src/core/AssetManager.js';
        import { ErrorHandler } from '../src/core/ErrorHandler.js';

        // åˆ›å»ºæ¨¡æ‹Ÿçš„æ¸¸æˆå¼•æ“
        const mockGameEngine = {
            sceneManager: new SceneManager(),
            audioManager: new AudioManager(),
            inputManager: new InputManager(document.createElement('canvas')),
            assetManager: new AssetManager(),
            errorHandler: new ErrorHandler()
        };

        // åˆ›å»ºåºç« ç®¡ç†å™¨å®ä¾‹
        let prologueManager = null;

        // æ—¥å¿—ç³»ç»Ÿ
        const logContainer = document.getElementById('logContainer');
        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // æ›´æ–°UI
        function updateUI() {
            if (!prologueManager) return;

            document.getElementById('initStatus').textContent = prologueManager.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–';
            document.getElementById('activeStatus').textContent = prologueManager.isActivePrologue() ? 'å·²æ¿€æ´»' : 'æœªæ¿€æ´»';
            document.getElementById('currentAct').textContent = prologueManager.getCurrentAct();
            document.getElementById('actName').textContent = prologueManager.getCurrentActName();
            
            const playerData = prologueManager.getPlayerData();
            if (playerData) {
                document.getElementById('playerName').textContent = playerData.name || '-';
                document.getElementById('playerLevel').textContent = playerData.level;
                document.getElementById('playerCurrency').textContent = playerData.currency;
                document.getElementById('recruitedNPCs').textContent = playerData.prologueData.recruitedNPCs.join(', ') || '-';
                document.getElementById('battlesWon').textContent = playerData.prologueData.battlesWon;
                document.getElementById('completedActs').textContent = playerData.prologueData.completedActs.join(', ') || '-';
            }
            
            document.getElementById('prologueCompleted').textContent = prologueManager.isComplete() ? 'æ˜¯' : 'å¦';
        }

        // æµ‹è¯•å‡½æ•°
        window.testInit = async function() {
            try {
                addLog('å¼€å§‹åˆå§‹åŒ–åºç« ç®¡ç†å™¨...', 'info');
                prologueManager = new PrologueManager(mockGameEngine);
                await prologueManager.init();
                addLog('âœ“ åºç« ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ', 'info');
                updateUI();
            } catch (error) {
                addLog(`âœ— åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        };

        window.testStartPrologue = function() {
            if (!prologueManager || !prologueManager.isInitialized) {
                addLog('âœ— è¯·å…ˆåˆå§‹åŒ–åºç« ç®¡ç†å™¨', 'warn');
                return;
            }
            try {
                prologueManager.start('æµ‹è¯•è§’è‰²');
                addLog('âœ“ åºç« å·²å¼€å§‹', 'info');
                updateUI();
            } catch (error) {
                addLog(`âœ— å¼€å§‹åºç« å¤±è´¥: ${error.message}`, 'error');
            }
        };

        window.testGoToAct = function(actNumber) {
            if (!prologueManager || !prologueManager.isActivePrologue()) {
                addLog('âœ— è¯·å…ˆå¼€å§‹åºç« ', 'warn');
                return;
            }
            try {
                prologueManager.goToAct(actNumber);
                addLog(`âœ“ åˆ‡æ¢åˆ°ç¬¬${actNumber}å¹•`, 'info');
                updateUI();
            } catch (error) {
                addLog(`âœ— åˆ‡æ¢åœºæ™¯å¤±è´¥: ${error.message}`, 'error');
            }
        };

        window.testRecordChoice = function() {
            if (!prologueManager) {
                addLog('âœ— è¯·å…ˆåˆå§‹åŒ–åºç« ç®¡ç†å™¨', 'warn');
                return;
            }
            prologueManager.recordPlayerChoice('test_choice_1', 'é€‰æ‹©A');
            addLog('âœ“ è®°å½•ç©å®¶é€‰æ‹©: test_choice_1 = é€‰æ‹©A', 'info');
            updateUI();
        };

        window.testRecruitNPC = function() {
            if (!prologueManager) {
                addLog('âœ— è¯·å…ˆåˆå§‹åŒ–åºç« ç®¡ç†å™¨', 'warn');
                return;
            }
            const npcs = ['ç®¡éª‡', 'å‘¨ä»“'];
            const npc = npcs[Math.floor(Math.random() * npcs.length)];
            prologueManager.recruitNPC(npc);
            addLog(`âœ“ æ‹›å‹ŸNPC: ${npc}`, 'info');
            updateUI();
        };

        window.testRecordBattle = function() {
            if (!prologueManager) {
                addLog('âœ— è¯·å…ˆåˆå§‹åŒ–åºç« ç®¡ç†å™¨', 'warn');
                return;
            }
            prologueManager.recordBattleWon();
            prologueManager.recordEnemiesDefeated(5);
            addLog('âœ“ è®°å½•æˆ˜æ–—èƒœåˆ©ï¼Œå‡»è´¥5ä¸ªæ•Œäºº', 'info');
            updateUI();
        };

        window.testShowPlayerData = function() {
            if (!prologueManager) {
                addLog('âœ— è¯·å…ˆåˆå§‹åŒ–åºç« ç®¡ç†å™¨', 'warn');
                return;
            }
            const playerData = prologueManager.getPlayerData();
            addLog('ç©å®¶æ•°æ®:', 'info');
            addLog(JSON.stringify(playerData, null, 2), 'info');
        };

        window.testSaveProgress = function() {
            if (!prologueManager) {
                addLog('âœ— è¯·å…ˆåˆå§‹åŒ–åºç« ç®¡ç†å™¨', 'warn');
                return;
            }
            prologueManager.saveProgress();
            addLog('âœ“ è¿›åº¦å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨', 'info');
        };

        window.testLoadProgress = function() {
            if (!prologueManager) {
                addLog('âœ— è¯·å…ˆåˆå§‹åŒ–åºç« ç®¡ç†å™¨', 'warn');
                return;
            }
            const success = prologueManager.loadProgress();
            if (success) {
                addLog('âœ“ è¿›åº¦åŠ è½½æˆåŠŸ', 'info');
                updateUI();
            } else {
                addLog('âœ— æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„è¿›åº¦', 'warn');
            }
        };

        window.testClearProgress = function() {
            if (!prologueManager) {
                addLog('âœ— è¯·å…ˆåˆå§‹åŒ–åºç« ç®¡ç†å™¨', 'warn');
                return;
            }
            if (confirm('ç¡®å®šè¦æ¸…é™¤ä¿å­˜çš„è¿›åº¦å—ï¼Ÿ')) {
                prologueManager.clearProgress();
                addLog('âœ“ è¿›åº¦å·²æ¸…é™¤', 'info');
            }
        };

        window.testCompleteAct = function() {
            if (!prologueManager || !prologueManager.isActivePrologue()) {
                addLog('âœ— è¯·å…ˆå¼€å§‹åºç« ', 'warn');
                return;
            }
            prologueManager.completeCurrentAct();
            addLog(`âœ“ å®Œæˆç¬¬${prologueManager.getCurrentAct() - 1}å¹•`, 'info');
            updateUI();
        };

        window.testCompletePrologue = function() {
            if (!prologueManager) {
                addLog('âœ— è¯·å…ˆåˆå§‹åŒ–åºç« ç®¡ç†å™¨', 'warn');
                return;
            }
            prologueManager.complete();
            addLog('âœ“ åºç« å®Œæˆï¼', 'info');
            updateUI();
        };

        window.clearLog = function() {
            logContainer.innerHTML = '<div class="log-entry info">æ—¥å¿—å·²æ¸…é™¤</div>';
        };

        // æ‹¦æˆªconsole.log
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'info');
        };

        const originalWarn = console.warn;
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog(args.join(' '), 'warn');
        };

        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };

        // é¡µé¢åŠ è½½å®Œæˆ
        addLog('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆï¼Œè¯·ç‚¹å‡»"åˆå§‹åŒ–åºç« ç®¡ç†å™¨"å¼€å§‹æµ‹è¯•', 'info');
    </script>
</body>
</html>
