<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TutorialTooltip æµ‹è¯•é¡µé¢</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
    }

    h1 {
      color: white;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    #gameCanvas {
      border: 3px solid #333;
      background: #2c3e50;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      cursor: pointer;
    }

    .controls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    button:active {
      transform: translateY(0);
    }

    .info {
      margin-top: 20px;
      padding: 20px;
      background: rgba(255,255,255,0.95);
      border-radius: 10px;
      max-width: 800px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .info h2 {
      color: #333;
      margin-bottom: 10px;
    }

    .info p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 10px;
    }

    .info ul {
      color: #666;
      margin-left: 20px;
      line-height: 1.8;
    }

    .target-element {
      position: absolute;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.5);
      border-radius: 5px;
      pointer-events: none;
    }

    .status {
      margin-top: 10px;
      padding: 10px;
      background: rgba(255, 215, 0, 0.2);
      border-radius: 5px;
      color: #333;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ğŸ“ TutorialTooltip æµ‹è¯•é¡µé¢</h1>
  
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  
  <div class="controls">
    <button id="btnMovementTutorial">ç§»åŠ¨æ•™ç¨‹</button>
    <button id="btnPickupTutorial">æ‹¾å–æ•™ç¨‹</button>
    <button id="btnEquipmentTutorial">è£…å¤‡æ•™ç¨‹</button>
    <button id="btnCombatTutorial">æˆ˜æ–—æ•™ç¨‹</button>
    <button id="btnMultiStepTutorial">å¤šæ­¥éª¤æ•™ç¨‹</button>
    <button id="btnReset">é‡ç½®</button>
  </div>

  <div class="info">
    <h2>ğŸ“– åŠŸèƒ½è¯´æ˜</h2>
    <p><strong>TutorialTooltip</strong> æ˜¯ä¸€ä¸ªæ•™ç¨‹æç¤ºç»„ä»¶ï¼Œç”¨äºå¼•å¯¼ç©å®¶å­¦ä¹ æ¸¸æˆæœºåˆ¶ã€‚</p>
    
    <h3>âœ¨ ä¸»è¦åŠŸèƒ½ï¼š</h3>
    <ul>
      <li><strong>ç›®æ ‡å…ƒç´ é«˜äº®</strong>ï¼šè‡ªåŠ¨é«˜äº®éœ€è¦å…³æ³¨çš„UIå…ƒç´ </li>
      <li><strong>ç®­å¤´æŒ‡ç¤º</strong>ï¼šç®­å¤´æŒ‡å‘ç›®æ ‡å…ƒç´ ï¼ˆæ”¯æŒä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘ï¼‰</li>
      <li><strong>å¤šæ­¥éª¤å¯¼èˆª</strong>ï¼šæ”¯æŒä¸Šä¸€æ­¥ã€ä¸‹ä¸€æ­¥ã€è·³è¿‡ç­‰æ“ä½œ</li>
      <li><strong>è„‰å†²åŠ¨ç”»</strong>ï¼šé«˜äº®åŒºåŸŸå¸¦æœ‰å‘¼å¸æ•ˆæœ</li>
      <li><strong>æš‚åœæ¸¸æˆ</strong>ï¼šå¯é€‰æ‹©æ˜¯å¦åœ¨æ•™ç¨‹æœŸé—´æš‚åœæ¸¸æˆ</li>
    </ul>

    <h3>ğŸ® æ“ä½œè¯´æ˜ï¼š</h3>
    <ul>
      <li>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¯åŠ¨ä¸åŒçš„æ•™ç¨‹</li>
      <li>ç‚¹å‡»"ä¸‹ä¸€æ­¥"æŒ‰é’®ç»§ç»­æ•™ç¨‹</li>
      <li>ç‚¹å‡»"ä¸Šä¸€æ­¥"æŒ‰é’®è¿”å›ä¸Šä¸€æ­¥</li>
      <li>ç‚¹å‡»"è·³è¿‡"æŒ‰é’®è·³è¿‡å½“å‰æ•™ç¨‹</li>
      <li>æœ€åä¸€æ­¥ä¼šæ˜¾ç¤º"å®Œæˆ"æŒ‰é’®</li>
    </ul>

    <div class="status" id="status">
      çŠ¶æ€ï¼šç­‰å¾…å¯åŠ¨æ•™ç¨‹
    </div>
  </div>

  <script type="module">
    import { TutorialTooltip } from '../src/prologue/ui/TutorialTooltip.js';

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const statusDiv = document.getElementById('status');

    // æ¨¡æ‹ŸéŸ³é¢‘ç®¡ç†å™¨
    const mockAudioManager = {
      hasSound: () => false,
      playSound: () => {}
    };

    // åˆ›å»ºæ•™ç¨‹æç¤ºæ¡†
    const tooltip = new TutorialTooltip({
      audioManager: mockAudioManager
    });

    // æ¨¡æ‹Ÿç›®æ ‡å…ƒç´ 
    const targetElements = {
      movement: { x: 100, y: 100, width: 100, height: 100 },
      pickup: { x: 300, y: 150, width: 80, height: 80 },
      equipment: { x: 600, y: 100, width: 120, height: 120 },
      combat: { x: 400, y: 400, width: 150, height: 100 }
    };

    // æ•™ç¨‹æ•°æ®
    const tutorials = {
      movement: {
        id: 'movement_tutorial',
        title: 'ç§»åŠ¨æ•™ç¨‹',
        steps: [
          {
            text: 'ä½¿ç”¨ WASD æˆ–æ–¹å‘é”®ç§»åŠ¨ä½ çš„è§’è‰²ã€‚\nè¯•ç€ç§»åŠ¨åˆ°é«˜äº®åŒºåŸŸï¼',
            targetElement: targetElements.movement,
            arrowDirection: 'down'
          }
        ],
        pauseGame: true
      },
      pickup: {
        id: 'pickup_tutorial',
        title: 'æ‹¾å–æ•™ç¨‹',
        steps: [
          {
            text: 'é è¿‘ç‰©å“æ—¶ï¼ŒæŒ‰ E é”®æ‹¾å–ã€‚\nè¿™ä¸ªç®±å­é‡Œæœ‰å¥½ä¸œè¥¿ï¼',
            targetElement: targetElements.pickup,
            arrowDirection: 'left'
          }
        ],
        pauseGame: true
      },
      equipment: {
        id: 'equipment_tutorial',
        title: 'è£…å¤‡æ•™ç¨‹',
        steps: [
          {
            text: 'æ‰“å¼€èƒŒåŒ…ï¼ˆæŒ‰ I é”®ï¼‰æŸ¥çœ‹ä½ çš„ç‰©å“ã€‚\nç‚¹å‡»è£…å¤‡æ¥ç©¿æˆ´å®ƒä»¬ã€‚',
            targetElement: targetElements.equipment,
            arrowDirection: 'down'
          }
        ],
        pauseGame: false
      },
      combat: {
        id: 'combat_tutorial',
        title: 'æˆ˜æ–—æ•™ç¨‹',
        steps: [
          {
            text: 'æŒ‰ç©ºæ ¼é”®æ”»å‡»æ•Œäººã€‚\næ³¨æ„æ•Œäººçš„æ”»å‡»æ¨¡å¼ï¼',
            targetElement: targetElements.combat,
            arrowDirection: 'up'
          }
        ],
        pauseGame: true
      },
      multiStep: {
        id: 'multi_step_tutorial',
        title: 'å®Œæ•´æ¸¸æˆæ•™ç¨‹',
        steps: [
          {
            text: 'æ¬¢è¿æ¥åˆ°æ¸¸æˆï¼\né¦–å…ˆï¼Œè®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•ç§»åŠ¨ã€‚',
            targetElement: targetElements.movement,
            arrowDirection: 'down'
          },
          {
            text: 'å¾ˆå¥½ï¼ç°åœ¨å­¦ä¹ å¦‚ä½•æ‹¾å–ç‰©å“ã€‚\né è¿‘ç‰©å“å¹¶æŒ‰ E é”®ã€‚',
            targetElement: targetElements.pickup,
            arrowDirection: 'left'
          },
          {
            text: 'æ¥ä¸‹æ¥æ˜¯è£…å¤‡ç³»ç»Ÿã€‚\næ‰“å¼€èƒŒåŒ…æ¥ç®¡ç†ä½ çš„è£…å¤‡ã€‚',
            targetElement: targetElements.equipment,
            arrowDirection: 'down'
          },
          {
            text: 'æœ€åï¼Œå­¦ä¹ æˆ˜æ–—æŠ€å·§ã€‚\næŒ‰ç©ºæ ¼é”®æ”»å‡»æ•Œäººï¼',
            targetElement: targetElements.combat,
            arrowDirection: 'up'
          },
          {
            text: 'æ­å–œï¼ä½ å·²ç»æŒæ¡äº†æ‰€æœ‰åŸºç¡€æ“ä½œã€‚\nç°åœ¨å¯ä»¥å¼€å§‹ä½ çš„å†’é™©äº†ï¼',
            targetElement: null,
            arrowDirection: 'down'
          }
        ],
        pauseGame: true
      }
    };

    // è®¾ç½®å›è°ƒ
    tooltip.onComplete = (tutorial) => {
      console.log('æ•™ç¨‹å®Œæˆ:', tutorial.id);
      updateStatus(`âœ… æ•™ç¨‹ "${tutorial.title}" å·²å®Œæˆï¼`);
    };

    tooltip.onSkip = () => {
      console.log('æ•™ç¨‹è·³è¿‡');
      updateStatus('â­ï¸ æ•™ç¨‹å·²è·³è¿‡');
    };

    tooltip.onStepChange = (stepIndex, step) => {
      console.log('æ­¥éª¤å˜åŒ–:', stepIndex, step);
      updateStatus(`ğŸ“ å½“å‰æ­¥éª¤: ${stepIndex + 1}`);
    };

    // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
    function updateStatus(message) {
      statusDiv.textContent = `çŠ¶æ€ï¼š${message}`;
    }

    // æ¸²æŸ“å¾ªç¯
    let lastTime = 0;
    function gameLoop(currentTime) {
      const deltaTime = currentTime - lastTime;
      lastTime = currentTime;

      // æ¸…ç©ºç”»å¸ƒ
      ctx.fillStyle = '#2c3e50';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // ç»˜åˆ¶ç½‘æ ¼
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
      ctx.lineWidth = 1;
      for (let x = 0; x < canvas.width; x += 50) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y < canvas.height; y += 50) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }

      // ç»˜åˆ¶ç›®æ ‡å…ƒç´ 
      Object.entries(targetElements).forEach(([key, element]) => {
        ctx.fillStyle = 'rgba(100, 150, 200, 0.3)';
        ctx.fillRect(element.x, element.y, element.width, element.height);
        ctx.strokeStyle = 'rgba(100, 150, 200, 0.8)';
        ctx.lineWidth = 2;
        ctx.strokeRect(element.x, element.y, element.width, element.height);
        
        // ç»˜åˆ¶æ ‡ç­¾
        ctx.fillStyle = '#fff';
        ctx.font = '14px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(key, element.x + element.width / 2, element.y + element.height / 2);
      });

      // æ›´æ–°å’Œæ¸²æŸ“æ•™ç¨‹æç¤ºæ¡†
      tooltip.update(deltaTime);
      tooltip.render(ctx);

      requestAnimationFrame(gameLoop);
    }

    // å¯åŠ¨æ¸²æŸ“å¾ªç¯
    requestAnimationFrame(gameLoop);

    // é¼ æ ‡äº‹ä»¶å¤„ç†
    canvas.addEventListener('mousemove', (e) => {
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;
      tooltip.handleMouseMove(mouseX, mouseY);
    });

    canvas.addEventListener('click', (e) => {
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;
      tooltip.handleMouseClick(mouseX, mouseY);
    });

    // æŒ‰é’®äº‹ä»¶
    document.getElementById('btnMovementTutorial').addEventListener('click', () => {
      tooltip.showTutorial(tutorials.movement);
      updateStatus('ğŸ® ç§»åŠ¨æ•™ç¨‹å·²å¯åŠ¨');
    });

    document.getElementById('btnPickupTutorial').addEventListener('click', () => {
      tooltip.showTutorial(tutorials.pickup);
      updateStatus('ğŸ“¦ æ‹¾å–æ•™ç¨‹å·²å¯åŠ¨');
    });

    document.getElementById('btnEquipmentTutorial').addEventListener('click', () => {
      tooltip.showTutorial(tutorials.equipment);
      updateStatus('âš”ï¸ è£…å¤‡æ•™ç¨‹å·²å¯åŠ¨');
    });

    document.getElementById('btnCombatTutorial').addEventListener('click', () => {
      tooltip.showTutorial(tutorials.combat);
      updateStatus('âš”ï¸ æˆ˜æ–—æ•™ç¨‹å·²å¯åŠ¨');
    });

    document.getElementById('btnMultiStepTutorial').addEventListener('click', () => {
      tooltip.showTutorial(tutorials.multiStep);
      updateStatus('ğŸ“š å¤šæ­¥éª¤æ•™ç¨‹å·²å¯åŠ¨');
    });

    document.getElementById('btnReset').addEventListener('click', () => {
      tooltip.hide();
      updateStatus('ğŸ”„ å·²é‡ç½®');
    });

    console.log('TutorialTooltip æµ‹è¯•é¡µé¢å·²åŠ è½½');
    console.log('æç¤ºæ¡†å®ä¾‹:', tooltip);
  </script>
</body>
</html>
