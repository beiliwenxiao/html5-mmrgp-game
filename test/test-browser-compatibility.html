<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: #ffffff;
        }
        
        #test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #4a9eff;
            text-align: center;
        }
        
        .section {
            background: #2a2a4e;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .section h2 {
            color: #4a9eff;
            margin-top: 0;
        }
        
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: #1e1e3e;
            border-radius: 5px;
            border-left: 4px solid #666;
        }
        
        .test-item.pass {
            border-left-color: #51cf66;
        }
        
        .test-item.fail {
            border-left-color: #ff6b6b;
        }
        
        .test-item.warning {
            border-left-color: #ffd43b;
        }
        
        .test-name {
            font-weight: bold;
        }
        
        .test-result {
            padding: 5px 15px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .test-result.pass {
            background: #51cf66;
            color: #000;
        }
        
        .test-result.fail {
            background: #ff6b6b;
            color: #fff;
        }
        
        .test-result.warning {
            background: #ffd43b;
            color: #000;
        }
        
        .browser-info {
            background: #1e1e3e;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
        }
        
        .info-label {
            color: #aaa;
        }
        
        .info-value {
            color: #4a9eff;
            font-weight: bold;
        }
        
        button {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 10px 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background: #5aa9ff;
        }
        
        .summary {
            background: #1e1e3e;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
            font-size: 18px;
        }
        
        .summary-pass {
            color: #51cf66;
            font-size: 48px;
            font-weight: bold;
        }
        
        .summary-fail {
            color: #ff6b6b;
            font-size: 48px;
            font-weight: bold;
        }
        
        #game-canvas {
            display: none;
        }
    </style>
</head>
<body>
    <div id="test-container">
        <h1>ğŸŒ æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•</h1>
        
        <div class="section">
            <h2>æµè§ˆå™¨ä¿¡æ¯</h2>
            <div class="browser-info" id="browser-info">
                <div class="info-row">
                    <span class="info-label">æµè§ˆå™¨:</span>
                    <span class="info-value" id="browser-name">æ£€æµ‹ä¸­...</span>
                </div>
                <div class="info-row">
                    <span class="info-label">ç‰ˆæœ¬:</span>
                    <span class="info-value" id="browser-version">æ£€æµ‹ä¸­...</span>
                </div>
                <div class="info-row">
                    <span class="info-label">æ“ä½œç³»ç»Ÿ:</span>
                    <span class="info-value" id="os-name">æ£€æµ‹ä¸­...</span>
                </div>
                <div class="info-row">
                    <span class="info-label">User Agent:</span>
                    <span class="info-value" id="user-agent" style="font-size: 12px; word-break: break-all;">æ£€æµ‹ä¸­...</span>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•</h2>
            <div id="core-tests"></div>
        </div>
        
        <div class="section">
            <h2>Canvas API æµ‹è¯•</h2>
            <div id="canvas-tests"></div>
        </div>
        
        <div class="section">
            <h2>JavaScript API æµ‹è¯•</h2>
            <div id="js-tests"></div>
        </div>
        
        <div class="section">
            <h2>æ€§èƒ½ API æµ‹è¯•</h2>
            <div id="performance-tests"></div>
        </div>
        
        <div class="section">
            <h2>æµ‹è¯•æ€»ç»“</h2>
            <div class="summary" id="summary">
                <div>æ­£åœ¨è¿è¡Œæµ‹è¯•...</div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="runAllTests()">é‡æ–°æµ‹è¯•</button>
                <button onclick="exportResults()">å¯¼å‡ºç»“æœ</button>
            </div>
        </div>
    </div>
    
    <canvas id="game-canvas" width="800" height="600"></canvas>

    <script>
        let testResults = {
            passed: 0,
            failed: 0,
            warnings: 0,
            tests: []
        };
        
        // æ£€æµ‹æµè§ˆå™¨ä¿¡æ¯
        function detectBrowser() {
            const ua = navigator.userAgent;
            let browserName = 'Unknown';
            let browserVersion = 'Unknown';
            let osName = 'Unknown';
            
            // æ£€æµ‹æµè§ˆå™¨
            if (ua.indexOf('Chrome') > -1 && ua.indexOf('Edg') === -1) {
                browserName = 'Chrome';
                browserVersion = ua.match(/Chrome\/(\d+)/)?.[1] || 'Unknown';
            } else if (ua.indexOf('Edg') > -1) {
                browserName = 'Edge';
                browserVersion = ua.match(/Edg\/(\d+)/)?.[1] || 'Unknown';
            } else if (ua.indexOf('Firefox') > -1) {
                browserName = 'Firefox';
                browserVersion = ua.match(/Firefox\/(\d+)/)?.[1] || 'Unknown';
            } else if (ua.indexOf('Safari') > -1 && ua.indexOf('Chrome') === -1) {
                browserName = 'Safari';
                browserVersion = ua.match(/Version\/(\d+)/)?.[1] || 'Unknown';
            }
            
            // æ£€æµ‹æ“ä½œç³»ç»Ÿ
            if (ua.indexOf('Win') > -1) osName = 'Windows';
            else if (ua.indexOf('Mac') > -1) osName = 'macOS';
            else if (ua.indexOf('Linux') > -1) osName = 'Linux';
            else if (ua.indexOf('Android') > -1) osName = 'Android';
            else if (ua.indexOf('iOS') > -1) osName = 'iOS';
            
            document.getElementById('browser-name').textContent = browserName;
            document.getElementById('browser-version').textContent = browserVersion;
            document.getElementById('os-name').textContent = osName;
            document.getElementById('user-agent').textContent = ua;
            
            return { browserName, browserVersion, osName, ua };
        }
        
        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(category, name, passed, message = '') {
            const result = {
                category,
                name,
                passed,
                message
            };
            
            testResults.tests.push(result);
            
            if (passed === true) {
                testResults.passed++;
            } else if (passed === false) {
                testResults.failed++;
            } else {
                testResults.warnings++;
            }
            
            return result;
        }
        
        // æ¸²æŸ“æµ‹è¯•ç»“æœ
        function renderTestResult(containerId, result) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            
            let statusClass = 'fail';
            let statusText = 'å¤±è´¥';
            
            if (result.passed === true) {
                statusClass = 'pass';
                statusText = 'é€šè¿‡';
            } else if (result.passed === 'warning') {
                statusClass = 'warning';
                statusText = 'è­¦å‘Š';
            }
            
            div.className = `test-item ${statusClass}`;
            div.innerHTML = `
                <div>
                    <div class="test-name">${result.name}</div>
                    ${result.message ? `<div style="color: #aaa; font-size: 12px; margin-top: 5px;">${result.message}</div>` : ''}
                </div>
                <div class="test-result ${statusClass}">${statusText}</div>
            `;
            
            container.appendChild(div);
        }
        
        // æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
        function testCoreFeatures() {
            // Canvas æ”¯æŒ
            const canvas = document.createElement('canvas');
            const hasCanvas = !!canvas.getContext;
            addTestResult('core', 'HTML5 Canvas æ”¯æŒ', hasCanvas);
            renderTestResult('core-tests', testResults.tests[testResults.tests.length - 1]);
            
            // Canvas 2D Context
            const has2DContext = hasCanvas && !!canvas.getContext('2d');
            addTestResult('core', 'Canvas 2D Context', has2DContext);
            renderTestResult('core-tests', testResults.tests[testResults.tests.length - 1]);
            
            // requestAnimationFrame
            const hasRAF = !!window.requestAnimationFrame;
            addTestResult('core', 'requestAnimationFrame', hasRAF);
            renderTestResult('core-tests', testResults.tests[testResults.tests.length - 1]);
            
            // WebSocket
            const hasWebSocket = !!window.WebSocket;
            addTestResult('core', 'WebSocket', hasWebSocket);
            renderTestResult('core-tests', testResults.tests[testResults.tests.length - 1]);
            
            // localStorage
            const hasLocalStorage = !!window.localStorage;
            addTestResult('core', 'localStorage', hasLocalStorage);
            renderTestResult('core-tests', testResults.tests[testResults.tests.length - 1]);
        }
        
        // Canvas API æµ‹è¯•
        function testCanvasAPI() {
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            
            if (!ctx) {
                addTestResult('canvas', 'Canvas Context', false, 'æ— æ³•è·å– 2D Context');
                renderTestResult('canvas-tests', testResults.tests[testResults.tests.length - 1]);
                return;
            }
            
            // åŸºç¡€ç»˜åˆ¶
            try {
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(0, 0, 100, 100);
                addTestResult('canvas', 'åŸºç¡€ç»˜åˆ¶ (fillRect)', true);
            } catch (e) {
                addTestResult('canvas', 'åŸºç¡€ç»˜åˆ¶ (fillRect)', false, e.message);
            }
            renderTestResult('canvas-tests', testResults.tests[testResults.tests.length - 1]);
            
            // æ–‡æœ¬æ¸²æŸ“
            try {
                ctx.font = '20px Arial';
                ctx.fillText('Test', 10, 10);
                addTestResult('canvas', 'æ–‡æœ¬æ¸²æŸ“', true);
            } catch (e) {
                addTestResult('canvas', 'æ–‡æœ¬æ¸²æŸ“', false, e.message);
            }
            renderTestResult('canvas-tests', testResults.tests[testResults.tests.length - 1]);
            
            // å›¾åƒç»˜åˆ¶
            try {
                const img = new Image();
                ctx.drawImage(canvas, 0, 0);
                addTestResult('canvas', 'å›¾åƒç»˜åˆ¶', true);
            } catch (e) {
                addTestResult('canvas', 'å›¾åƒç»˜åˆ¶', false, e.message);
            }
            renderTestResult('canvas-tests', testResults.tests[testResults.tests.length - 1]);
            
            // æ¸å˜
            try {
                const gradient = ctx.createLinearGradient(0, 0, 100, 100);
                gradient.addColorStop(0, '#ff0000');
                gradient.addColorStop(1, '#0000ff');
                ctx.fillStyle = gradient;
                addTestResult('canvas', 'æ¸å˜æ”¯æŒ', true);
            } catch (e) {
                addTestResult('canvas', 'æ¸å˜æ”¯æŒ', false, e.message);
            }
            renderTestResult('canvas-tests', testResults.tests[testResults.tests.length - 1]);
            
            // é˜´å½±
            try {
                ctx.shadowColor = '#000000';
                ctx.shadowBlur = 10;
                ctx.shadowOffsetX = 5;
                ctx.shadowOffsetY = 5;
                addTestResult('canvas', 'é˜´å½±æ”¯æŒ', true);
            } catch (e) {
                addTestResult('canvas', 'é˜´å½±æ”¯æŒ', false, e.message);
            }
            renderTestResult('canvas-tests', testResults.tests[testResults.tests.length - 1]);
            
            // å˜æ¢
            try {
                ctx.save();
                ctx.translate(50, 50);
                ctx.rotate(Math.PI / 4);
                ctx.scale(2, 2);
                ctx.restore();
                addTestResult('canvas', 'å˜æ¢æ“ä½œ', true);
            } catch (e) {
                addTestResult('canvas', 'å˜æ¢æ“ä½œ', false, e.message);
            }
            renderTestResult('canvas-tests', testResults.tests[testResults.tests.length - 1]);
        }
        
        // JavaScript API æµ‹è¯•
        function testJavaScriptAPI() {
            // ES6 æ”¯æŒ
            try {
                eval('const test = () => {};');
                addTestResult('js', 'ES6 ç®­å¤´å‡½æ•°', true);
            } catch (e) {
                addTestResult('js', 'ES6 ç®­å¤´å‡½æ•°', false, e.message);
            }
            renderTestResult('js-tests', testResults.tests[testResults.tests.length - 1]);
            
            // Promise
            const hasPromise = !!window.Promise;
            addTestResult('js', 'Promise', hasPromise);
            renderTestResult('js-tests', testResults.tests[testResults.tests.length - 1]);
            
            // async/await
            try {
                eval('async function test() { await Promise.resolve(); }');
                addTestResult('js', 'async/await', true);
            } catch (e) {
                addTestResult('js', 'async/await', false, e.message);
            }
            renderTestResult('js-tests', testResults.tests[testResults.tests.length - 1]);
            
            // Map/Set
            const hasMap = !!window.Map;
            const hasSet = !!window.Set;
            addTestResult('js', 'Map/Set', hasMap && hasSet);
            renderTestResult('js-tests', testResults.tests[testResults.tests.length - 1]);
            
            // Array methods
            const hasArrayMethods = !![].map && !![].filter && !![].reduce;
            addTestResult('js', 'Array æ–¹æ³•', hasArrayMethods);
            renderTestResult('js-tests', testResults.tests[testResults.tests.length - 1]);
            
            // JSON
            const hasJSON = !!window.JSON;
            addTestResult('js', 'JSON', hasJSON);
            renderTestResult('js-tests', testResults.tests[testResults.tests.length - 1]);
        }
        
        // æ€§èƒ½ API æµ‹è¯•
        function testPerformanceAPI() {
            // performance.now()
            const hasPerformanceNow = !!(window.performance && window.performance.now);
            addTestResult('performance', 'performance.now()', hasPerformanceNow);
            renderTestResult('performance-tests', testResults.tests[testResults.tests.length - 1]);
            
            // requestAnimationFrame
            const hasRAF = !!window.requestAnimationFrame;
            addTestResult('performance', 'requestAnimationFrame', hasRAF);
            renderTestResult('performance-tests', testResults.tests[testResults.tests.length - 1]);
            
            // cancelAnimationFrame
            const hasCancelRAF = !!window.cancelAnimationFrame;
            addTestResult('performance', 'cancelAnimationFrame', hasCancelRAF);
            renderTestResult('performance-tests', testResults.tests[testResults.tests.length - 1]);
            
            // Performance Observer
            const hasPerformanceObserver = !!window.PerformanceObserver;
            addTestResult('performance', 'PerformanceObserver', hasPerformanceObserver ? 'warning' : false, 
                hasPerformanceObserver ? 'æ”¯æŒä½†éå¿…éœ€' : 'ä¸æ”¯æŒï¼ˆéå¿…éœ€ï¼‰');
            renderTestResult('performance-tests', testResults.tests[testResults.tests.length - 1]);
        }
        
        // æ›´æ–°æ€»ç»“
        function updateSummary() {
            const summary = document.getElementById('summary');
            const total = testResults.passed + testResults.failed + testResults.warnings;
            const passRate = ((testResults.passed / total) * 100).toFixed(1);
            
            let summaryClass = 'summary-pass';
            let summaryText = 'âœ“ å…¼å®¹';
            
            if (testResults.failed > 0) {
                summaryClass = 'summary-fail';
                summaryText = 'âœ— ä¸å…¼å®¹';
            }
            
            summary.innerHTML = `
                <div class="${summaryClass}">${summaryText}</div>
                <div style="margin-top: 20px; color: #aaa;">
                    <div>é€šè¿‡: <span style="color: #51cf66;">${testResults.passed}</span></div>
                    <div>å¤±è´¥: <span style="color: #ff6b6b;">${testResults.failed}</span></div>
                    <div>è­¦å‘Š: <span style="color: #ffd43b;">${testResults.warnings}</span></div>
                    <div>æ€»è®¡: ${total}</div>
                    <div style="margin-top: 10px; font-size: 24px; color: #4a9eff;">é€šè¿‡ç‡: ${passRate}%</div>
                </div>
            `;
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            // é‡ç½®ç»“æœ
            testResults = {
                passed: 0,
                failed: 0,
                warnings: 0,
                tests: []
            };
            
            // æ¸…ç©ºå®¹å™¨
            document.getElementById('core-tests').innerHTML = '';
            document.getElementById('canvas-tests').innerHTML = '';
            document.getElementById('js-tests').innerHTML = '';
            document.getElementById('performance-tests').innerHTML = '';
            
            // è¿è¡Œæµ‹è¯•
            detectBrowser();
            testCoreFeatures();
            testCanvasAPI();
            testJavaScriptAPI();
            testPerformanceAPI();
            updateSummary();
        }
        
        // å¯¼å‡ºç»“æœ
        function exportResults() {
            const browserInfo = detectBrowser();
            const report = {
                timestamp: new Date().toISOString(),
                browser: browserInfo,
                results: testResults
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `browser-compatibility-${browserInfo.browserName}-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // é¡µé¢åŠ è½½æ—¶è¿è¡Œæµ‹è¯•
        window.runAllTests = runAllTests;
        window.exportResults = exportResults;
        
        // è‡ªåŠ¨è¿è¡Œ
        runAllTests();
    </script>
</body>
</html>
