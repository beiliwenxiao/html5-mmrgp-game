<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆåœºæ™¯æµ‹è¯• - Game Scene Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            overflow: hidden;
        }

        #gameCanvas {
            display: block;
            background: #2d5016;
            margin: 0 auto;
        }

        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 5px;
            max-width: 300px;
        }

        #controls h2 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #ffaa00;
        }

        #controls p {
            margin: 5px 0;
            font-size: 13px;
            line-height: 1.5;
        }

        .key {
            display: inline-block;
            padding: 2px 6px;
            background: #333;
            border: 1px solid #666;
            border-radius: 3px;
            font-family: monospace;
            font-size: 11px;
        }

        #stats {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 5px;
            min-width: 200px;
        }

        #stats h3 {
            margin-bottom: 10px;
            font-size: 16px;
            color: #00ff88;
        }

        #stats p {
            margin: 5px 0;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="1280" height="720"></canvas>
    
    <div id="controls">
        <h2>ğŸ® æ¸¸æˆåœºæ™¯æµ‹è¯•</h2>
        <p><strong>ç§»åŠ¨:</strong> <span class="key">WASD</span> æˆ–æ–¹å‘é”®</p>
        <p><strong>ç‚¹å‡»ç§»åŠ¨:</strong> é¼ æ ‡å·¦é”®</p>
        <p><strong>é€‰æ‹©ç›®æ ‡:</strong> ç‚¹å‡»æ•Œäºº</p>
        <p><strong>æ”»å‡»:</strong> è‡ªåŠ¨æ”»å‡»é€‰ä¸­ç›®æ ‡</p>
        <p><strong>æŠ€èƒ½:</strong></p>
        <p><span class="key">1</span> æ™®é€šæ”»å‡»</p>
        <p><span class="key">2</span> å¼ºåŠ›æ–©å‡»</p>
        <p><span class="key">3</span> å†²é”‹</p>
        <p><span class="key">4</span> é˜²å¾¡å§¿æ€</p>
    </div>

    <div id="stats">
        <h3>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h3>
        <p>FPS: <span id="fps">60</span></p>
        <p>å®ä½“æ•°: <span id="entities">0</span></p>
        <p>ç²’å­æ•°: <span id="particles">0</span></p>
        <p>ç©å®¶ä½ç½®: <span id="playerPos">0, 0</span></p>
    </div>

    <script type="module">
        import { GameEngine } from './src/core/GameEngine.js';
        import { GameScene } from './src/scenes/GameScene.js';

        // åˆ›å»ºæ¸¸æˆå¼•æ“
        const canvas = document.getElementById('gameCanvas');
        const engine = new GameEngine(canvas);

        // å‡†å¤‡è§’è‰²æ•°æ®
        const characterData = {
            id: 'player_1',
            name: 'æµ‹è¯•æˆ˜å£«',
            class: 'warrior',
            level: 5,
            exp: 0,
            stats: {
                hp: 150,
                maxHp: 150,
                mp: 50,
                maxMp: 50,
                attack: 15,
                defense: 10,
                speed: 100
            },
            skills: ['basic_attack', 'warrior_slash', 'warrior_charge', 'warrior_defense'],
            position: { x: 400, y: 300 }
        };

        // åˆå§‹åŒ–å¹¶å¯åŠ¨æ¸¸æˆå¼•æ“
        async function startGame() {
            await engine.init();
            engine.start();
            
            // ç­‰å¾…ä¸€å¸§ååˆ‡æ¢åœºæ™¯
            setTimeout(() => {
                engine.sceneManager.switchTo('Game', { character: characterData });
            }, 100);
        }

        startGame();

        // FPS è®¡ç®—
        let lastTime = performance.now();
        let frameCount = 0;
        let fps = 60;

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            // è®¡ç®—FPS
            const currentTime = performance.now();
            frameCount++;
            
            if (currentTime - lastTime >= 1000) {
                fps = Math.round(frameCount * 1000 / (currentTime - lastTime));
                frameCount = 0;
                lastTime = currentTime;
            }

            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('fps').textContent = fps;
            
            // è·å–å½“å‰åœºæ™¯
            const currentScene = engine.sceneManager?.getCurrentScene();
            if (currentScene && currentScene.name === 'Game') {
                document.getElementById('entities').textContent = currentScene.entities?.length || 0;
                
                if (currentScene.particleSystem) {
                    document.getElementById('particles').textContent = currentScene.particleSystem.getActiveCount();
                }
                
                if (currentScene.player) {
                    const transform = currentScene.player.getComponent('transform');
                    if (transform) {
                        const x = Math.round(transform.position.x);
                        const y = Math.round(transform.position.y);
                        document.getElementById('playerPos').textContent = `${x}, ${y}`;
                    }
                }
            }

            requestAnimationFrame(updateStats);
        }

        updateStats();

        console.log('æ¸¸æˆåœºæ™¯æµ‹è¯•å¯åŠ¨');
    </script>
</body>
</html>
