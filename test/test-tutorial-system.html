<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•™ç¨‹ç³»ç»Ÿæµ‹è¯•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      background: #2c3e50;
      color: #ecf0f1;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #3498db;
    }

    .main-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    .game-area {
      background: #34495e;
      border-radius: 10px;
      padding: 20px;
      min-height: 600px;
      position: relative;
    }

    .control-panel {
      background: #34495e;
      border-radius: 10px;
      padding: 20px;
    }

    .section {
      margin-bottom: 20px;
    }

    .section h2 {
      color: #3498db;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #3498db;
    }

    button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
      transition: background 0.3s;
    }

    button:hover {
      background: #2980b9;
    }

    button:disabled {
      background: #95a5a6;
      cursor: not-allowed;
    }

    button.danger {
      background: #e74c3c;
    }

    button.danger:hover {
      background: #c0392b;
    }

    button.success {
      background: #27ae60;
    }

    button.success:hover {
      background: #229954;
    }

    .tutorial-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .tutorial-overlay.active {
      display: flex;
    }

    .tutorial-box {
      background: white;
      color: #2c3e50;
      border-radius: 10px;
      padding: 30px;
      max-width: 500px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateY(-50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .tutorial-title {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 10px;
      color: #3498db;
    }

    .tutorial-step {
      font-size: 1.1em;
      margin: 20px 0;
      line-height: 1.6;
    }

    .tutorial-progress {
      color: #7f8c8d;
      font-size: 0.9em;
      margin-bottom: 20px;
    }

    .tutorial-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    .highlight {
      border: 3px solid #f39c12;
      box-shadow: 0 0 20px rgba(243, 156, 18, 0.5);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 0 20px rgba(243, 156, 18, 0.5);
      }
      50% {
        box-shadow: 0 0 30px rgba(243, 156, 18, 0.8);
      }
    }

    .game-element {
      background: #2c3e50;
      border: 2px solid #3498db;
      border-radius: 5px;
      padding: 15px;
      margin: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .game-element:hover {
      background: #34495e;
      transform: scale(1.05);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .stat-item {
      background: #2c3e50;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
    }

    .stat-label {
      color: #95a5a6;
      font-size: 0.9em;
    }

    .stat-value {
      color: #3498db;
      font-size: 1.2em;
      font-weight: bold;
    }

    .tutorial-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .tutorial-item {
      background: #2c3e50;
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .tutorial-item.completed {
      opacity: 0.6;
      background: #27ae60;
    }

    .log {
      background: #1a252f;
      padding: 15px;
      border-radius: 5px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }

    .log-entry {
      margin: 5px 0;
      padding: 3px 0;
      border-bottom: 1px solid #2c3e50;
    }

    .log-entry.success {
      color: #27ae60;
    }

    .log-entry.error {
      color: #e74c3c;
    }

    .log-entry.info {
      color: #3498db;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“š æ•™ç¨‹ç³»ç»Ÿæµ‹è¯•</h1>

    <div class="main-content">
      <!-- æ¸¸æˆåŒºåŸŸ -->
      <div class="game-area">
        <h2 style="color: #3498db; margin-bottom: 20px;">æ¸¸æˆåœºæ™¯</h2>
        
        <div class="stats">
          <div class="stat-item">
            <div class="stat-label">ç©å®¶ç­‰çº§</div>
            <div class="stat-value" id="player-level">1</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">å®Œæˆæ•™ç¨‹</div>
            <div class="stat-value" id="completed-count">0</div>
          </div>
        </div>

        <div id="game-elements">
          <div class="game-element" id="player-element">
            <h3>ğŸ® ç©å®¶è§’è‰²</h3>
            <p>ç‚¹å‡»ä¸ç©å®¶äº’åŠ¨</p>
          </div>

          <div class="game-element" id="inventory-element">
            <h3>ğŸ’ èƒŒåŒ…ç³»ç»Ÿ</h3>
            <p>ç‚¹å‡»æ‰“å¼€èƒŒåŒ…</p>
          </div>

          <div class="game-element" id="combat-element">
            <h3>âš”ï¸ æˆ˜æ–—ç³»ç»Ÿ</h3>
            <p>ç‚¹å‡»è¿›å…¥æˆ˜æ–—</p>
          </div>

          <div class="game-element" id="skill-element">
            <h3>âœ¨ æŠ€èƒ½ç³»ç»Ÿ</h3>
            <p>ç‚¹å‡»å­¦ä¹ æŠ€èƒ½</p>
          </div>
        </div>

        <!-- æ•™ç¨‹è¦†ç›–å±‚ -->
        <div class="tutorial-overlay" id="tutorial-overlay">
          <div class="tutorial-box">
            <div class="tutorial-title" id="tutorial-title">æ•™ç¨‹æ ‡é¢˜</div>
            <div class="tutorial-progress" id="tutorial-progress">æ­¥éª¤ 1 / 3</div>
            <div class="tutorial-step" id="tutorial-step">æ•™ç¨‹å†…å®¹...</div>
            <div class="tutorial-buttons">
              <button onclick="window.skipTutorial()" id="skip-btn">è·³è¿‡</button>
              <div>
                <button onclick="window.previousStep()" id="prev-btn">ä¸Šä¸€æ­¥</button>
                <button class="success" onclick="window.nextStep()" id="next-btn">ä¸‹ä¸€æ­¥</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- æ§åˆ¶é¢æ¿ -->
      <div class="control-panel">
        <div class="section">
          <h2>æ•™ç¨‹åˆ—è¡¨</h2>
          <div class="tutorial-list" id="tutorial-list"></div>
        </div>

        <div class="section">
          <h2>æ§åˆ¶</h2>
          <button onclick="window.resetAllTutorials()">é‡ç½®æ‰€æœ‰æ•™ç¨‹</button>
          <button class="danger" onclick="window.toggleTutorialSystem()">
            <span id="toggle-text">ç¦ç”¨æ•™ç¨‹ç³»ç»Ÿ</span>
          </button>
        </div>

        <div class="section">
          <h2>æ—¥å¿—</h2>
          <div class="log" id="log"></div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { TutorialSystem } from '../src/prologue/systems/TutorialSystem.js';

    // åˆå§‹åŒ–ç³»ç»Ÿ
    const tutorialSystem = new TutorialSystem();
    
    // æ¸¸æˆçŠ¶æ€
    const gameState = {
      playerLevel: 1,
      hasOpenedInventory: false,
      hasEnteredCombat: false,
      hasLearnedSkill: false
    };

    // æ—¥å¿—å‡½æ•°
    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    // æ›´æ–°UI
    function updateUI() {
      document.getElementById('player-level').textContent = gameState.playerLevel;
      const progress = tutorialSystem.getProgress();
      document.getElementById('completed-count').textContent = 
        `${progress.completed} / ${progress.total}`;
      
      renderTutorialList();
    }

    // æ¸²æŸ“æ•™ç¨‹åˆ—è¡¨
    function renderTutorialList() {
      const container = document.getElementById('tutorial-list');
      container.innerHTML = '';

      const tutorials = tutorialSystem.getAllTutorials();
      tutorials.forEach(tutorial => {
        const item = document.createElement('div');
        const completed = tutorialSystem.isTutorialCompleted(tutorial.id);
        item.className = `tutorial-item ${completed ? 'completed' : ''}`;
        
        item.innerHTML = `
          <div>
            <strong>${tutorial.title}</strong>
            <div style="font-size: 0.9em; color: #95a5a6;">
              ${tutorial.steps.length} æ­¥éª¤ | ${tutorial.category}
            </div>
          </div>
          <button onclick="window.startTutorial('${tutorial.id}')" 
                  ${completed ? 'disabled' : ''}>
            ${completed ? 'å·²å®Œæˆ' : 'å¼€å§‹'}
          </button>
        `;
        
        container.appendChild(item);
      });
    }

    // æ˜¾ç¤ºæ•™ç¨‹
    function showTutorialUI(stepData) {
      const overlay = document.getElementById('tutorial-overlay');
      overlay.classList.add('active');

      document.getElementById('tutorial-title').textContent = stepData.tutorialTitle;
      document.getElementById('tutorial-progress').textContent = 
        `æ­¥éª¤ ${stepData.stepIndex + 1} / ${stepData.totalSteps}`;
      document.getElementById('tutorial-step').textContent = stepData.step.text;

      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      document.getElementById('skip-btn').style.display = stepData.canSkip ? 'block' : 'none';
      document.getElementById('prev-btn').disabled = stepData.stepIndex === 0;
      document.getElementById('next-btn').textContent = 
        stepData.isLastStep ? 'å®Œæˆ' : 'ä¸‹ä¸€æ­¥';

      // é«˜äº®ç›®æ ‡å…ƒç´ 
      document.querySelectorAll('.game-element').forEach(el => {
        el.classList.remove('highlight');
      });

      if (stepData.step.target && stepData.step.highlightTarget) {
        const targetElement = document.getElementById(`${stepData.step.target}-element`);
        if (targetElement) {
          targetElement.classList.add('highlight');
        }
      }
    }

    // éšè—æ•™ç¨‹
    function hideTutorialUI() {
      const overlay = document.getElementById('tutorial-overlay');
      overlay.classList.remove('active');

      // ç§»é™¤æ‰€æœ‰é«˜äº®
      document.querySelectorAll('.game-element').forEach(el => {
        el.classList.remove('highlight');
      });
    }

    // è®¾ç½®å›è°ƒ
    tutorialSystem.onShow(showTutorialUI);
    tutorialSystem.onHide(hideTutorialUI);
    tutorialSystem.onComplete((tutorialId) => {
      log(`âœ“ å®Œæˆæ•™ç¨‹: ${tutorialId}`, 'success');
      updateUI();
    });

    // å…¨å±€å‡½æ•°
    window.startTutorial = function(tutorialId) {
      log(`å¼€å§‹æ•™ç¨‹: ${tutorialId}`);
      tutorialSystem.showTutorial(tutorialId, gameState);
    };

    window.nextStep = function() {
      const hasNext = tutorialSystem.nextStep(gameState);
      if (!hasNext) {
        log('æ•™ç¨‹å®Œæˆ', 'success');
      }
    };

    window.previousStep = function() {
      tutorialSystem.previousStep(gameState);
    };

    window.skipTutorial = function() {
      const result = tutorialSystem.skipTutorial();
      if (result) {
        log('è·³è¿‡æ•™ç¨‹', 'info');
        updateUI();
      }
    };

    window.resetAllTutorials = function() {
      tutorialSystem.resetTutorial();
      log('é‡ç½®æ‰€æœ‰æ•™ç¨‹', 'info');
      updateUI();
    };

    window.toggleTutorialSystem = function() {
      const enabled = !tutorialSystem.enabled;
      tutorialSystem.setEnabled(enabled);
      document.getElementById('toggle-text').textContent = 
        enabled ? 'ç¦ç”¨æ•™ç¨‹ç³»ç»Ÿ' : 'å¯ç”¨æ•™ç¨‹ç³»ç»Ÿ';
      log(enabled ? 'å¯ç”¨æ•™ç¨‹ç³»ç»Ÿ' : 'ç¦ç”¨æ•™ç¨‹ç³»ç»Ÿ', 'info');
    };

    // æ³¨å†Œæµ‹è¯•æ•™ç¨‹
    tutorialSystem.registerTutorial('movement', {
      title: 'ç§»åŠ¨æ•™ç¨‹',
      description: 'å­¦ä¹ å¦‚ä½•ç§»åŠ¨è§’è‰²',
      steps: [
        { text: 'æ¬¢è¿æ¥åˆ°æ¸¸æˆï¼è®©æˆ‘ä»¬å…ˆå­¦ä¹ å¦‚ä½•ç§»åŠ¨ã€‚', target: 'player' },
        { text: 'ä½¿ç”¨ WASD é”®æˆ–æ–¹å‘é”®æ¥ç§»åŠ¨ä½ çš„è§’è‰²ã€‚', target: 'player' },
        { text: 'ä½ ä¹Ÿå¯ä»¥ç‚¹å‡»åœ°é¢æ¥ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®ã€‚', target: 'player' }
      ],
      category: 'basic',
      priority: 10,
      autoTrigger: true,
      triggerCondition: (state) => state.playerLevel === 1
    });

    tutorialSystem.registerTutorial('inventory', {
      title: 'èƒŒåŒ…æ•™ç¨‹',
      description: 'å­¦ä¹ å¦‚ä½•ä½¿ç”¨èƒŒåŒ…',
      steps: [
        { text: 'æŒ‰ I é”®æ‰“å¼€èƒŒåŒ…ç•Œé¢ã€‚', target: 'inventory' },
        { text: 'ä½ å¯ä»¥åœ¨èƒŒåŒ…ä¸­æŸ¥çœ‹å’Œç®¡ç†ç‰©å“ã€‚', target: 'inventory' },
        { text: 'ç‚¹å‡»ç‰©å“å¯ä»¥ä½¿ç”¨æˆ–è£…å¤‡å®ƒä»¬ã€‚', target: 'inventory' }
      ],
      category: 'basic',
      priority: 9,
      autoTrigger: true,
      triggerCondition: (state) => !state.hasOpenedInventory && state.playerLevel >= 2
    });

    tutorialSystem.registerTutorial('combat', {
      title: 'æˆ˜æ–—æ•™ç¨‹',
      description: 'å­¦ä¹ å¦‚ä½•æˆ˜æ–—',
      steps: [
        { text: 'å½“é‡åˆ°æ•Œäººæ—¶ï¼Œæˆ˜æ–—ä¼šè‡ªåŠ¨å¼€å§‹ã€‚', target: 'combat' },
        { text: 'æŒ‰ç©ºæ ¼é”®è¿›è¡Œæ™®é€šæ”»å‡»ã€‚', target: 'combat' },
        { text: 'ä½¿ç”¨æ•°å­—é”® 1-4 é‡Šæ”¾æŠ€èƒ½ã€‚', target: 'combat' },
        { text: 'æ³¨æ„ä½ çš„ç”Ÿå‘½å€¼å’Œæ³•åŠ›å€¼ï¼', target: 'combat' }
      ],
      category: 'combat',
      priority: 8,
      pauseGame: true,
      autoTrigger: true,
      triggerCondition: (state) => !state.hasEnteredCombat && state.playerLevel >= 3
    });

    tutorialSystem.registerTutorial('skills', {
      title: 'æŠ€èƒ½æ•™ç¨‹',
      description: 'å­¦ä¹ å¦‚ä½•ä½¿ç”¨æŠ€èƒ½',
      steps: [
        { text: 'æŒ‰ K é”®æ‰“å¼€æŠ€èƒ½ç•Œé¢ã€‚', target: 'skill' },
        { text: 'ä½ å¯ä»¥å­¦ä¹ å’Œå‡çº§æŠ€èƒ½ã€‚', target: 'skill' },
        { text: 'æ¯ä¸ªæŠ€èƒ½éƒ½æœ‰ç‹¬ç‰¹çš„æ•ˆæœå’Œå†·å´æ—¶é—´ã€‚', target: 'skill' }
      ],
      category: 'advanced',
      priority: 7,
      canSkip: false,
      autoTrigger: true,
      triggerCondition: (state) => !state.hasLearnedSkill && state.playerLevel >= 5
    });

    // æ¸¸æˆå…ƒç´ äº¤äº’
    document.getElementById('player-element').addEventListener('click', () => {
      log('ä¸ç©å®¶äº’åŠ¨');
      gameState.playerLevel++;
      updateUI();
    });

    document.getElementById('inventory-element').addEventListener('click', () => {
      log('æ‰“å¼€èƒŒåŒ…');
      gameState.hasOpenedInventory = true;
    });

    document.getElementById('combat-element').addEventListener('click', () => {
      log('è¿›å…¥æˆ˜æ–—');
      gameState.hasEnteredCombat = true;
    });

    document.getElementById('skill-element').addEventListener('click', () => {
      log('å­¦ä¹ æŠ€èƒ½');
      gameState.hasLearnedSkill = true;
    });

    // åˆå§‹åŒ–
    log('æ•™ç¨‹ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
    log(`æ³¨å†Œäº† ${tutorialSystem.getAllTutorials().length} ä¸ªæ•™ç¨‹`);
    updateUI();

    // æ¸¸æˆå¾ªç¯
    function gameLoop() {
      tutorialSystem.update(0.016, gameState);
      requestAnimationFrame(gameLoop);
    }
    gameLoop();
  </script>
</body>
</html>
